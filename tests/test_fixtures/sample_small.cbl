000100 IDENTIFICATION DIVISION.
000200 PROGRAM-ID. SAMPLE-PROGRAM.
000300 AUTHOR. TEST-AUTHOR.
000400 DATE-WRITTEN. 2025-01-01.

000700 ENVIRONMENT DIVISION.
000800 CONFIGURATION SECTION.
000900 SOURCE-COMPUTER. IBM-Z15.
001000 OBJECT-COMPUTER. IBM-Z15.

001200 INPUT-OUTPUT SECTION.
001300 FILE-CONTROL.
001400     SELECT INPUT-FILE ASSIGN TO 'INFILE'
001500     ORGANIZATION IS SEQUENTIAL
001600     ACCESS MODE IS SEQUENTIAL
001700     FILE STATUS IS WS-INPUT-STATUS.

001800     SELECT OUTPUT-FILE ASSIGN TO 'OUTFILE'
001900     ORGANIZATION IS SEQUENTIAL
002000     ACCESS MODE IS SEQUENTIAL
002100     FILE STATUS IS WS-OUTPUT-STATUS.

004200 DATA DIVISION.
004300 FILE SECTION.

004500 FD  INPUT-FILE
004600     RECORDING MODE IS F
004700 RECORD CONTAINS 80 CHARACTERS.
004800 01  INPUT-RECORD.
004900 05  INPUT-ID          PIC 9(5).
005000 05  INPUT-NAME        PIC X(20).
005100 05  INPUT-AMOUNT      PIC 9(8)V99.
005200 05  FILLER            PIC X(45).

005400 FD  OUTPUT-FILE
005500     RECORDING MODE IS F
005600 RECORD CONTAINS 80 CHARACTERS.
005700 01  OUTPUT-RECORD.
005800 05  OUTPUT-ID         PIC 9(5).
005900 05  OUTPUT-NAME       PIC X(20).
006000 05  OUTPUT-AMOUNT     PIC 9(8)V99.
006100 05  FILLER            PIC X(45).

013300 WORKING-STORAGE SECTION.

013500* File Status Variables
013600 01  WS-INPUT-STATUS        PIC XX.
013700 01  WS-OUTPUT-STATUS       PIC XX.

013900* Control Variables
014000 01  WS-EOF-FLAG            PIC X VALUE 'N'.
014100 88  EOF-REACHED        VALUE 'Y'.

014300* Work Variables
014400 01  WS-TOTAL-AMOUNT        PIC 9(10)V99 VALUE ZERO.
014500 01  WS-RECORD-COUNT        PIC 9(6) VALUE ZERO.

021400 PROCEDURE DIVISION.

021600 0000-MAIN-CONTROL SECTION.
021700 0000-MAIN-PROCESS.
021800     PERFORM 1000-INITIALIZE-PROGRAM
021900     PERFORM 2000-PROCESS-RECORDS
022000     PERFORM 9000-FINALIZE-PROGRAM
022100     STOP RUN.

022300 1000-INITIALIZE-PROGRAM SECTION.
022400 1000-INIT-START.
022500     DISPLAY 'SAMPLE PROGRAM - INITIALIZING'
022600     PERFORM 1100-OPEN-FILES
022700     PERFORM 1200-INITIALIZE-VARIABLES.

022900 1100-OPEN-FILES.
023000     OPEN INPUT INPUT-FILE
023100     IF WS-INPUT-STATUS NOT = '00'
023200     DISPLAY 'ERROR OPENING INPUT FILE: ' WS-INPUT-STATUS
023300     STOP RUN
023400     END-IF
023500 
023600     OPEN OUTPUT OUTPUT-FILE
023700     IF WS-OUTPUT-STATUS NOT = '00'
023800     DISPLAY 'ERROR OPENING OUTPUT FILE: ' WS-OUTPUT-STATUS
023900     STOP RUN
024000     END-IF.

024200 1200-INITIALIZE-VARIABLES.
024300     MOVE 'N' TO WS-EOF-FLAG
024400     MOVE ZERO TO WS-TOTAL-AMOUNT
024500     MOVE ZERO TO WS-RECORD-COUNT.

024700 2000-PROCESS-RECORDS SECTION.
024800 2000-PROCESS-START.
024900     DISPLAY 'BEGINNING RECORD PROCESSING'
025000     PERFORM 2100-READ-RECORD
025100     PERFORM UNTIL EOF-REACHED
025200     PERFORM 2200-PROCESS-RECORD
025300     PERFORM 2100-READ-RECORD
025400     END-PERFORM
025500     DISPLAY 'RECORD PROCESSING COMPLETED'.

025700 2100-READ-RECORD.
025800     READ INPUT-FILE AT END SET EOF-REACHED TO TRUE NOT AT END
025900     ADD 1 TO WS-RECORD-COUNT
026000     IF WS-RECORD-COUNT = 1 OR FUNCTION MOD(WS-RECORD-COUNT, 100) = 0
026100     DISPLAY 'PROCESSED: ' WS-RECORD-COUNT ' RECORDS'
026200     END-IF
026300 END-READ.

026500 2200-PROCESS-RECORD.
026600     ADD INPUT-AMOUNT TO WS-TOTAL-AMOUNT
026700     MOVE INPUT-ID TO OUTPUT-ID
026800     MOVE INPUT-NAME TO OUTPUT-NAME
026900     MOVE INPUT-AMOUNT TO OUTPUT-AMOUNT
027000     WRITE OUTPUT-RECORD
027100     IF WS-OUTPUT-STATUS NOT = '00'
027200     DISPLAY 'ERROR WRITING OUTPUT RECORD: ' WS-OUTPUT-STATUS
027300     STOP RUN
027400     END-IF.

027600 9000-FINALIZE-PROGRAM SECTION.
027700 9000-FINALIZE-START.
027800     PERFORM 9100-CLOSE-FILES
027900     PERFORM 9200-DISPLAY-STATISTICS
028000     DISPLAY 'SAMPLE PROGRAM - PROCESSING COMPLETED'.

028200 9100-CLOSE-FILES.
028300     CLOSE INPUT-FILE
028400     CLOSE OUTPUT-FILE.

028600 9200-DISPLAY-STATISTICS.
028700     DISPLAY ' '
028800     DISPLAY '=========================================='
028900     DISPLAY 'PROCESSING STATISTICS'
029000     DISPLAY '=========================================='
029100     DISPLAY 'TOTAL RECORDS PROCESSED: ' WS-RECORD-COUNT
029200     DISPLAY 'TOTAL AMOUNT: ' WS-TOTAL-AMOUNT
029300     DISPLAY '=========================================='.

029500* END OF SAMPLE-PROGRAM
